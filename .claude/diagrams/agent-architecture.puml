@startuml agent-architecture
!theme plain
skinparam linetype ortho

title Agentéšå±¤ã¨ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ - çµ„ç¹”è¨­è¨ˆåŸå‰‡ã«åŸºã¥ãè‡ªå¾‹å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ 

/' äººé–“ãƒ¬ã‚¤ãƒ¤ãƒ¼ '/
package "Human Layer (æˆ¦ç•¥ãƒ»æ‰¿èª)" {
  actor "TechLead" as techlead #LightBlue
  actor "PO" as po #LightGreen
  actor "CISO" as ciso #LightCoral
  actor "CTO" as cto #LightYellow
}

/' BaseAgentæŠ½è±¡ã‚¯ãƒ©ã‚¹ '/
abstract class BaseAgent {
  - agentType: string
  - config: AgentConfig
  - startTime: number
  + log(message: string): void
  + {abstract} execute(task: Task): Promise<AgentResult>
  + escalate(message, target, severity, data): Promise<void>
}

/' Coordinator Layer '/
package "Coordinator Layer (çµ±æ‹¬)" {
  class CoordinatorAgent {
    {field} ğŸ”´ **çµ±æ‹¬æ¨©é™**
    --
    + execute(task: Task): AgentResult
    --
    **è²¬ä»»ç¯„å›²:**
    - Issue â†’ Taskåˆ†è§£
    - DAGæ§‹ç¯‰ãƒ»ãƒˆãƒãƒ­ã‚¸ã‚«ãƒ«ã‚½ãƒ¼ãƒˆ
    - Agentå‰²ã‚Šå½“ã¦
    - ä¸¦è¡Œå®Ÿè¡Œåˆ¶å¾¡ (æœ€å¤§5ä¸¦è¡Œ)
    --
    **ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³:**
    - TechLead (å¾ªç’°ä¾å­˜æ¤œå‡º)
    - PO (è¦ä»¶ä¸æ˜ç¢º)
  }
}

/' Specialist Layer '/
package "Specialist Layer (å°‚é–€å®Ÿè¡Œ)" {

  class CodeGenAgent {
    {field} ğŸ”µ **å®Ÿè¡Œæ¨©é™**
    --
    + execute(task: Task): AgentResult
    --
    **è²¬ä»»ç¯„å›²:**
    - TypeScriptã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
    - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆç”Ÿæˆ
    - BaseAgentãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè£…
    --
    **ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³:**
    - TechLead (ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å•é¡Œ)
  }

  class ReviewAgent {
    {field} ğŸŸ¡ **åˆ¤å®šæ¨©é™**
    --
    + execute(task: Task): AgentResult
    + calculateQualityScore(): number
    --
    **è²¬ä»»ç¯„å›²:**
    - é™çš„è§£æ (ESLint/TypeScript)
    - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³
    - å“è³ªã‚¹ã‚³ã‚¢ç®—å‡º (0-100ç‚¹)
    - åˆæ ¼ãƒ©ã‚¤ãƒ³: 80ç‚¹ä»¥ä¸Š
    --
    **ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³:**
    - CISO (Criticalè„†å¼±æ€§)
    - TechLead (å“è³ªã‚¹ã‚³ã‚¢50ç‚¹æœªæº€)
  }

  class IssueAgent {
    {field} ğŸ”µ **åˆ†ææ¨©é™**
    --
    + execute(task: Task): AgentResult
    + classifyIssue(): IssueClassification
    --
    **è²¬ä»»ç¯„å›²:**
    - Issueç¨®åˆ¥åˆ¤å®š
    - 53ãƒ©ãƒ™ãƒ«è‡ªå‹•ä»˜ä¸
    - Severityè©•ä¾¡ (Sev.1-5)
    - æ‹…å½“è€…è‡ªå‹•ã‚¢ã‚µã‚¤ãƒ³
    --
    **ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³:**
    - TechLead (æŠ€è¡“åˆ¤æ–­)
    - PO (ãƒ“ã‚¸ãƒã‚¹åˆ¤æ–­)
    - CISO (ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)
  }

  class PRAgent {
    {field} ğŸ”µ **ä½œæˆæ¨©é™**
    --
    + execute(task: Task): AgentResult
    + generatePRTitle(): string
    --
    **è²¬ä»»ç¯„å›²:**
    - Draft PRè‡ªå‹•ä½œæˆ
    - Conventional Commitsæº–æ‹ 
    - ãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼è‡ªå‹•å‰²ã‚Šå½“ã¦
    - é–¢é€£Issueç´ä»˜ã‘
    --
    **ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³:**
    - TechLead (æ¨©é™ã‚¨ãƒ©ãƒ¼)
  }

  class DeploymentAgent {
    {field} ğŸ”´ **å®Ÿè¡Œæ¨©é™** (Staging)
    {field} ğŸŸ¡ **æ‰¿èªå¾Œå®Ÿè¡Œ** (Production)
    --
    + execute(task: Task): AgentResult
    + healthCheck(): boolean
    + rollback(): void
    --
    **è²¬ä»»ç¯„å›²:**
    - Firebase/Vercelãƒ‡ãƒ—ãƒ­ã‚¤
    - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ (5-10å›ãƒªãƒˆãƒ©ã‚¤)
    - è‡ªå‹•Rollback
    --
    **ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³:**
    - CTO (æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å¤±æ•—)
    - TechLead (ãƒ“ãƒ«ãƒ‰å¤±æ•—)
  }
}

/' ç¶™æ‰¿é–¢ä¿‚ '/
BaseAgent <|-- CoordinatorAgent
BaseAgent <|-- CodeGenAgent
BaseAgent <|-- ReviewAgent
BaseAgent <|-- IssueAgent
BaseAgent <|-- PRAgent
BaseAgent <|-- DeploymentAgent

/' å®Ÿè¡Œé–¢ä¿‚ (Coordinator â†’ Specialists) '/
CoordinatorAgent --> CodeGenAgent : "assigns"
CoordinatorAgent --> ReviewAgent : "assigns"
CoordinatorAgent --> IssueAgent : "assigns"
CoordinatorAgent --> PRAgent : "assigns"
CoordinatorAgent --> DeploymentAgent : "assigns"

/' Agenté–“ã®é€£æº '/
CodeGenAgent --> ReviewAgent : "triggers after\ncode generation"
ReviewAgent --> PRAgent : "triggers after\nquality check (â‰¥80ç‚¹)"
PRAgent --> DeploymentAgent : "triggers after\nPR merge"

/' ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–¢ä¿‚ '/
CoordinatorAgent ..> techlead : "å¾ªç’°ä¾å­˜\næ¤œå‡ºæ™‚"
CoordinatorAgent ..> po : "è¦ä»¶ä¸æ˜ç¢ºæ™‚"

CodeGenAgent ..> techlead : "ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£\nå•é¡Œæ™‚"

ReviewAgent ..> ciso : "Criticalè„†å¼±æ€§\næ¤œå‡ºæ™‚"
ReviewAgent ..> techlead : "å“è³ªã‚¹ã‚³ã‚¢\n50ç‚¹æœªæº€"

IssueAgent ..> techlead : "æŠ€è¡“åˆ¤æ–­\nå¿…è¦æ™‚"
IssueAgent ..> po : "ãƒ“ã‚¸ãƒã‚¹åˆ¤æ–­\nå¿…è¦æ™‚"
IssueAgent ..> ciso : "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£\né–¢é€£æ™‚"

PRAgent ..> techlead : "æ¨©é™ã‚¨ãƒ©ãƒ¼æ™‚"

DeploymentAgent ..> cto : "æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤\nå¤±æ•—æ™‚"
DeploymentAgent ..> techlead : "ãƒ“ãƒ«ãƒ‰å¤±æ•—æ™‚"

note right of CoordinatorAgent
  **ä¸¦è¡Œå®Ÿè¡Œåˆ¶å¾¡**
  - DAGæ§‹ç¯‰ (Kahn's Algorithm)
  - ãƒˆãƒãƒ­ã‚¸ã‚«ãƒ«ã‚½ãƒ¼ãƒˆ
  - ä¸¦è¡Œåº¦ç®—å‡º (æœ€å¤§5)
  - å¾ªç’°ä¾å­˜æ¤œå‡º (DFS)
end note

note right of ReviewAgent
  **å“è³ªã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°**
  base_score: 100ç‚¹
  - ESLintã‚¨ãƒ©ãƒ¼: -20ç‚¹/ä»¶
  - TypeScriptã‚¨ãƒ©ãƒ¼: -30ç‚¹/ä»¶
  - Criticalè„†å¼±æ€§: -40ç‚¹/ä»¶
  - Highè„†å¼±æ€§: -20ç‚¹/ä»¶
  åˆæ ¼ãƒ©ã‚¤ãƒ³: 80ç‚¹ä»¥ä¸Š
end note

note bottom of DeploymentAgent
  **Productionæ‰¿èªãƒ•ãƒ­ãƒ¼**
  1. Stagingè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ âœ“
  2. CTOã¸æ‰¿èªãƒªã‚¯ã‚¨ã‚¹ãƒˆ
  3. æ‰¿èªå¾Œã«Productionãƒ‡ãƒ—ãƒ­ã‚¤
  4. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ (10å›)
  5. å¤±æ•—æ™‚ã¯è‡ªå‹•Rollback
end note

legend right
  |= æ¨©é™ãƒ¬ãƒ™ãƒ« |= èª¬æ˜ |
  | ğŸ”´ çµ±æ‹¬æ¨©é™ | ã‚¿ã‚¹ã‚¯åˆ†è§£ãƒ»Agentå‰²ã‚Šå½“ã¦ãƒ»ãƒªã‚½ãƒ¼ã‚¹é…åˆ†ã‚’æ±ºå®šå¯èƒ½ |
  | ğŸ”µ å®Ÿè¡Œæ¨©é™ | ã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ»PRä½œæˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œã‚’ç›´æ¥å®Ÿè¡Œå¯èƒ½ |
  | ğŸŸ¡ åˆ¤å®šæ¨©é™ | å“è³ªåˆå¦åˆ¤å®šã‚’å®Ÿè¡Œå¯èƒ½ (åˆæ ¼åŸºæº–ã«åŸºã¥ã) |

  **çµ„ç¹”è¨­è¨ˆåŸå‰‡5åŸå‰‡**
  1. è²¬ä»»ã®æ˜ç¢ºåŒ– - å„Agentã®å½¹å‰²ã‚’æ˜ç¢ºã«å®šç¾©
  2. æ¨©é™ã®æ˜ç¢ºåŒ– - Agentæ¯ã®å®Ÿè¡Œæ¨©é™ã‚’åˆ¶é™
  3. éšå±¤ã®æ˜ç¢ºåŒ– - Coordinator â†’ Specialist ã®éšå±¤æ§‹é€ 
  4. çµæœã®æ˜ç¢ºåŒ– - æˆåŠŸæ¡ä»¶ãƒ»KPIã‚’æ•°å€¤åŒ–
  5. æ›–æ˜§æ€§ã®æ’é™¤ - YAML/JSONå½¢å¼ã§æ§‹é€ åŒ–
endlegend

@enduml
